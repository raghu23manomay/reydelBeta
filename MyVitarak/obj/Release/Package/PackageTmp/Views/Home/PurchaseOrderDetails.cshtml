
@model  IEnumerable<MyVitarak.Models.PurchaseOrderDetails>
@{
    Layout = "~/Views/Shared/_layout.cshtml";
}
<div>
    @using (Html.BeginForm("PurchaseOrderDetails", "Home", FormMethod.Post))
    {

        <div class="ibox">

            <div class="ibox-content" style="padding-top:55px;">
                @{
                    decimal totalQty = 0;
                }
                @foreach (var item in Model)
                {
                    totalQty = totalQty + item.Quantity;
                    <div class="ibox" style="margin-bottom: 4px!important;">
                        <div class="feed-activity-list">
                            <div class="feed-element Vendor" name="@item.ProductName" Qantity="@item.Quantity" BillId="@item.BillId"  ProductId="@item.ProductId">

                                <span class="pull-left">
                                    <img alt="image" style="height: 40px;width: 40px" src="~/Content/images/SmallBottle.png" />
                                </span>
                                <div class="media-body ">
                                    <small class="pull-right"> <strong>  @item.Quantity </strong> </small>
                                    <strong>
                                        <label class="Product">  @item.ProductName </label>
                                    </strong>   
                                </div> 
                            </div> 
                        </div>
                    </div> 
                }
                <input type="hidden" id="BillIdGlobal" value="@Model.First().BillId">
                @if (Model.Count() > 0)
                {
                    <div class="ibox footer" style="margin-bottom: 0px!important;">


                        <table class="table small m-b-xs" style="font-size:12px;">
                            <tbody>

                                <tr style="  border-top: 1px dashed #e7eaec" id="trpay">
                                    <td>
                                        <button class="btn btn-primary" type="button" id="btnConfirmOrder">Confirm Order  </button>
                                      
                                    </td>
                                    <td class="pull-right">
                                        <strong>
                                            Total Quantity : @totalQty
                                        </strong>
                                    </td>
                                </tr>
                            </tbody>
                        </table>



                    </div>
                }
            </div>
        </div>
    }
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

<script type="text/javascript">
    $(".Vendor").click(function () {
        
        $('#UpdateQuantity').show();
        $('#MainContent').addClass("blur");
       var Pname= this.getAttribute("name")
        $("#ProductName").val(Pname);
        $('#txtQuantity').val(this.getAttribute("Qantity"));
        $('#BillId').val(this.getAttribute("BillId"));
        document.getElementById('ProductName').innerHTML = Pname;
        $('#ProductId').val(this.getAttribute("ProductId"));

    });
    $(".btnclose").click(function () {
        $("#UpdateQuantity").hide();
        $('#MainContent').removeClass("blur");
        $("#PaymentModal").hide();
    });
    $("#btnPay").click(function () {
        $("#PaymentModal").show();
        $('#MainContent').addClass("blur");

    });
    $("#btnSavePayment").click(function () {

        var CustomerID = $("#CustomerID").val();
        var BillId = $("#BillIdGlobal").val();
        var CashAmount = $("#txtCashAmount").val();
        var ChequeAmount = $("#txtChequeAmount").val();
        var  ChequeNo = $("#txtChequeNo").val();


        $.ajax({
            type: "POST",
            url: "../home/SavePayment?CustomerID=" + CustomerID + "&BillId=" + BillId + "&CashAmount=" + CashAmount + "&ChequeAmount=" + ChequeAmount + "&ChequeNo=" + ChequeNo,

            contentType: "application/json; charset=utf-8",

            success: function (msg) {
                $('#PaymentModal').hide();
                $('#MainContent').removeClass("blur");

                var Day = $(".btn-primary").attr("id");
                var Month = new Date().getMonth() + 1;
                var Year = new Date().getFullYear();
                $.ajax({
                    type: "POST",
                    url: "../home/PurchaseOrderDetails?CustomerID=" + CustomerID + "&Day=" + Day + "&Month=" + Month + "&Year=" + Year,

                    contentType: "application/json; charset=utf-8",

                    success: function (msg) {

                        $("#createOrder").hide();
                        $("#ShowList").show();
                        $("#ShowList").html(msg);
                    }
                    , error: function (msg) {

                        $("#createOrder").show();
                        $("#ShowList").hide();

                    }
                });


            }
            , error: function (msg) {


            }
        });

    });
    $("#btnUpdatePurchaseQuantity").click(function () { 
        
        $("#pageLoader").show();
        var VendorID = $("#VendorID").val();
        var BillId = $("#BillId").val();
        var ProductId = $("#ProductId").val();
        var Quantity = $("#txtQuantity").val();
        var likageQty = $("#txtlikageQty").val();
        if (Quantity == "") { 
            $('#Quantity_error_msg').html("Please Enter Qantity.");
            $('#Quantity_error_msg').show();
            $("#pageLoader").hide();
            return false;
        }
        else {
            $('#Quantity_error_msg').hide();
        }
        if (likageQty == "") { 
            $('#Likage_error_msg').html("Please Enter Qantity.");
            $('#Likage_error_msg').show(); 
            $("#pageLoader").hide();
            return false;
        }
        else {
            $('#Quantity_error_msg').hide();
        }
        $.ajax({
            type: "POST",
            url: "../home/UpdatePurchaseQuantity?VendorID=" + VendorID + "&BillId=" + BillId + "&ProductID=" + ProductId + "&Quantity=" + Quantity + "&likageQty=" + likageQty ,

            contentType: "application/json; charset=utf-8",

            success: function (msg) {
                $('#UpdateQuantity').hide();
                $('#MainContent').removeClass("blur");

                var Day = $(".btn-primary").attr("id");
                var Month = new Date().getMonth() + 1;
                var Year = new Date().getFullYear();
                $.ajax({
                    type: "POST",
                    url: "../home/PurchaseOrderDetails?VendorID=" + VendorID + "&Day=" + Day + "&Month=" + Month + "&Year=" + Year,

                    contentType: "application/json; charset=utf-8",

                    success: function (msg) {

                        $("#createOrder").hide();
                        $("#ShowList").show();
                        $("#ShowList").html(msg);
                        $("#pageLoader").hide();
                    }
                    , error: function (msg) {
                        $("#pageLoader").hide();
                    }
                });

            }
            , error: function (msg) {
                $("#pageLoader").hide();

            }
        });

    });

    $('#btnConfirmOrder').click(function () {
        
        $("#pageLoader").show();
        var Day = $(".btn-primary").attr("id");
        var VendorID = $("#VendorID").val()
        var Month = new Date().getMonth() + 1;
        var Year = new Date().getFullYear();

        $.ajax({
            type: "POST",
            url: "../home/ConfirmPurchaseOrder?VendorID=" + VendorID + "&Day=" + Day + "&Month=" + Month + "&Year=" + Year,
            contentType: "application/json; charset=utf-8",
            success: function (msg) {
                $("#pageLoader").hide();
            }
        });
        $("#pageLoader").hide();
    });
</script>