
@model  IEnumerable<MyVitarak.Models.OrderDetails>
@{
    Layout = "~/Views/Shared/_layout.cshtml";
}
<div>
    @using (Html.BeginForm("OrderDetails", "Home", FormMethod.Post))
    {

    <div class="ibox">

         
        <div class="ibox-content" style="padding-top:55px;">
            @{
                decimal totalAmt = 0;
            }
            @foreach (var item in Model)
            {
                totalAmt = totalAmt + item.Amount;
                <div class="ibox" style="margin-bottom: 4px!important;">
                    <div class="feed-activity-list">
                        <div class="feed-element Customer" name=" @item.Product" Qantity="@item.Quantity" BillId="@item.BillId" ProductId="@item.ProductId">

                            <span class="pull-left">
                                <img alt="image" style="height: 40px;width: 40px" src="~/Content/images/SmallBottle.png" />
                            </span>
                            <div class="media-body ">
                                <small class="pull-right"> <strong> <i class="fa fa-inr"></i>  @item.Amount </strong> </small>
                                <strong>
                                    <label class="Product">  @item.Product </label>
                                </strong> <br>
                                <small class="text-muted"> @item.Quantity</small>
                            </div>

                        </div>

                    </div>
                </div>

            }
            <input type="hidden" id="BillIdGlobal" value="@Model.First().BillId">
            @if (Model.Count() > 0)
            {
                <div class="ibox footer" style="margin-bottom: 0px!important;">
                    

                        <table class="table small m-b-xs" style="font-size:12px;">
                            <tbody>
                                <tr>
                                    <td style="margin-left:50px:">
                                        <strong> Sub Total</strong>
                                    </td>
                                    <td class="pull-right">
                                        <strong><i class="fa fa-inr"></i>   @totalAmt</strong>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong> Prev Due</strong>
                                    </td>
                                    <td class="pull-right">
                                        <strong><i class="fa fa-inr"></i>   @Model.FirstOrDefault().PreviousBalance</strong>
                                    </td>
                                </tr>

                                <tr style="  border-top: 1px dashed #e7eaec">
                                    <td>
                                        <strong>   Total </strong>
                                    </td>
                                    <td class="pull-right">

                                        <strong><i class="fa fa-inr"></i>  @Model.FirstOrDefault().BalanceDue </strong>
                                    </td>
                                </tr>
                               
                                <tr style="  border-top: 1px dashed #e7eaec" id="trpay">
                                    <td>
                                        <strong>
                                            Paid Amount : <i class="fa fa-inr"></i>  @{ var s = Model.FirstOrDefault().CashAmount + @Model.FirstOrDefault().ChequeAmount;}
                                            @s
                                        </strong>
                                    </td>
                                    <td class="pull-right" >
                                        <button class="btn btn-primary" type="button"  id="btnPay">Pay  </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                   

                </div>
            }
        </div>
    </div>
    }
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
 
<script type="text/javascript">
    $(".Customer").click(function () {
        
        $('#UpdateQuantity').show();
        $('#MainContent').addClass("blur");
       var Pname= this.getAttribute("name")
        $("#ProductName").val(Pname);
        $('#txtQuantity').val(this.getAttribute("Qantity"));
        $('#BillId').val(this.getAttribute("BillId"));
        document.getElementById('ProductName').innerHTML = Pname; 
        $('#ProductId').val(this.getAttribute("ProductId"));
        
    });
    $(".btnclose").click(function () {
        $("#UpdateQuantity").hide();
        $('#MainContent').removeClass("blur"); 
        $("#PaymentModal").hide();
    });
    $("#btnPay").click(function () {
        $("#PaymentModal").show();
        $('#MainContent').addClass("blur");
         
    });
    $("#btnSavePayment").click(function () {
       
        var CustomerID = $("#CustomerID").val();
        var BillId = $("#BillIdGlobal").val(); 
        var CashAmount = $("#txtCashAmount").val(); 
        var ChequeAmount = $("#txtChequeAmount").val(); 
        var  ChequeNo = $("#txtChequeNo").val(); 
        
        if (CashAmount == "") {
            $('#CashAmount_error_msg').html("Please Enter Amount.");
            $('#CashAmount_error_msg').show();
            $("#pageLoader").hide();
            return false;
        }
        else {
            $('#CashAmount_error_msg').hide();
        }
        if (ChequeAmount == "") {
            $('#ChequeAmount_error_msg').html("Please Enter Amount.");
            $('#ChequeAmount_error_msg').show();
            $("#pageLoader").hide();
            return false;
        }
        else {
            $('#ChequeAmount_error_msg').hide();
        }
        $.ajax({
            type: "POST",
            url: "../home/SavePayment?CustomerID=" + CustomerID + "&BillId=" + BillId + "&CashAmount=" + CashAmount + "&ChequeAmount=" + ChequeAmount + "&ChequeNo=" + ChequeNo, 

            contentType: "application/json; charset=utf-8",

            success: function (msg) {
                $('#PaymentModal').hide();
                $('#MainContent').removeClass("blur");

                var Day = $(".btn-primary").attr("id");
                var Month = new Date().getMonth() + 1;
                var Year = new Date().getFullYear();
                
                
                $.ajax({
                    type: "POST",
                    url: "../home/OrderDetails?CustomerID=" + CustomerID + "&Day=" + Day + "&Month=" + Month + "&Year=" + Year,

                    contentType: "application/json; charset=utf-8",

                    success: function (msg) {

                        $("#createOrder").hide();
                        $("#ShowList").show();
                        $("#ShowList").html(msg);
                    }
                    , error: function (msg) {

                        $("#createOrder").show();
                        $("#ShowList").hide();

                    }
                });


            }
            , error: function (msg) {


            }
        });

    });
    $("#btnUpdateQuantity").click(function () {
        $("#pageLoader").show();
        var CustomerID = $("#CustomerID").val();
        var BillId = $("#BillId").val(); 
        var ProductId = $("#ProductId").val();
        var Quantity = $("#txtQuantity").val();
        if (Quantity == "") {
            $('#Quantity_error_msg').html("Please Enter Quantity.");
            $('#Quantity_error_msg').show();
            $("#pageLoader").hide();
            return false;
        }
        $.ajax({
            type: "POST",
            url: "../home/UpdateQuantity?CustomerID=" + CustomerID + "&BillId=" + BillId + "&ProductID=" + ProductId + "&Quantity=" + Quantity  ,

            contentType: "application/json; charset=utf-8",

            success: function (msg) {
                $('#UpdateQuantity').hide();
                $('#MainContent').removeClass("blur");
                
                var Day = $(".btn-primary").attr("id");
                var Month = new Date().getMonth() + 1;
                var Year = new Date().getFullYear();
                $.ajax({
                    type: "POST",
                    url: "../home/OrderDetails?CustomerID=" + CustomerID + "&Day=" + Day + "&Month=" + Month + "&Year=" + Year,

                    contentType: "application/json; charset=utf-8",

                    success: function (msg) {
                        
                        $("#createOrder").hide();
                        $("#ShowList").show();
                        $("#ShowList").html(msg);
                        $("#pageLoader").hide();
                    }
                    , error: function (msg) {
                        
                        $("#createOrder").show();
                        $("#ShowList").hide();

                    }
                });
          
            }
            , error: function (msg) {
                $("#pageLoader").hide();
                
            }
        });

    });

     
</script>